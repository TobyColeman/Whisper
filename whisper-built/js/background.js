(function(){function r(){chrome.runtime.onMessageExternal.addListener(function(t,n,r){if(t.type=="update_post_info"){e.uid=t.uid,e.fb_dtsg=t.fb_dtsg;return}return chrome.tabs.query({active:!0,currentWindow:!0},function(e){chrome.tabs.sendMessage(e[0].id,t,function(e){r(e)})}),!0})}r();var e={uid:null,fb_dtsg:null},t="https://[^ ]*messenger.com/[^ ]*",n="https://[^ ]*messenger.com/t/[^ ]*";chrome.runtime.onMessage.addListener(function i(t,n,s){if(t.type=="getThreadInfo")s({payload:e});else if(t.type=="enabled"){var o=t.enabled==1?"images/locked.png":"images/unlocked.png",u=t.enabled==1?"Whisper":"No private key";chrome.pageAction.setIcon({tabId:n.tab.id,path:{19:o,38:o}},function(){chrome.pageAction.setTitle({title:u,tabId:n.tab.id}),t.enabled||(chrome.runtime.onMessage.removeListener(i),chrome.runtime.onMessageExternal.removeListener(r))})}}),chrome.tabs.onUpdated.addListener(function(e,r,i){i.url.match(t)?(chrome.pageAction.show(i.id),!i.url.match(n)||chrome.tabs.sendMessage(i.id,{type:"init",init:!0})):chrome.pageAction.hide(i.id)})})();